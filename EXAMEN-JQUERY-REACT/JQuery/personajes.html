<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Personajes</title>
    <link href="./css/bootstrap.min.css" rel="stylesheet" />
  </head>
  <body>
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
      <a class="navbar-brand" href="home.html">
        <img
          src="https://dbdzm869oupei.cloudfront.net/img/sticker/preview/9371.png"
          width="125"
          height="50"
          alt=""
        />
      </a>
      <button
        class="navbar-toggler"
        type="button"
        data-bs-toggle="collapse"
        data-bs-target="#navbarNav"
        aria-controls="navbarNav"
        aria-expanded="false"
        aria-label="Toggle navigation"
      >
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav">
          <li class="nav-item active">
            <a class="nav-link" href="home.html">Home</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="nuevoPersonaje.html">Nuevo personaje </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="modificarPersonajes.html"
              >Modificar personajes</a
            >
          </li>
          <li class="nav-item dropdown">
            <a
              class="nav-link dropdown-toggle"
              href="#"
              id="navbarDropdown"
              role="button"
              data-bs-toggle="dropdown"
              aria-expanded="false"
            >
              Series
            </a>
            <ul id="desplegable"></ul>
          </li>
        </ul>
      </div>
    </nav>

    <div class="d-flex flex-column align-items-center justify-content-center text-center">
        <a id="volver"></a>
        <table class="table table-dark" style=" width: 50%" id="datos">
            <thead class="table table-dark ">
                <tr>
                    <th>PERSONAJE</th>
                    <th>IMAGEN</th>
                </tr>
            </thead>
            <tbody>
            </tbody>
        </table>
      </div>


    <script src="./js/code.jquery.com_jquery-3.7.1.js"></script>
    <script src="./js/bootstrap.bundle.min.js"></script>
    <script src="./js/sweetaret.js"></script>
    <script>
      var urlSeries = "https://apiseriespersonajes.azurewebsites.net/";
      $(document).ready(function () {
        cargarSeries();
        cargarPersonajes();
      });

      function cargarPersonajes() {
        //NECESITO SACAR EL ID DEL EQUIPO
        var varUrlWeb = new URL(window.location.href);
        var idSerie = varUrlWeb.searchParams.get("idserie");
        console.log(idSerie);
        var request = "api/Series/PersonajesSerie/" + idSerie;
       $("#volver").html("<a href='serie.html?idserie=" + idSerie +"' class='btn btn-success'>Volver</a>")
        $.ajax({
                url: urlSeries + request,
                type: "GET",
                dataType: "json",
                success: function(data){
                    var html = "";
                    $.each(data, function (index, personaje) {
                        html += "<tr>";
                        html += "<td>" + personaje.nombre + "</td>";
                        html += "<td> <img src='" + personaje.imagen + "' style='width: 150px; height: 120px;'/></td>";
                        html += "</tr>";

                    })
                    $("#datos tbody").html(html);
                }
            })

      }

      function cargarSeries() {
        var request = "api/Series";
        $.ajax({
          url: urlSeries + request,
          type: "GET",
          dataType: "json",
          success: function (data) {
            var html = "";
            html +=
              " <ul class='dropdown-menu' aria-labelledby='navbarDropdown'>";
            $.each(data, function (index, serie) {
              html +=
                "<li><a class='dropdown-item' href='serie.html?idserie=" +
                serie.idSerie +
                "'>" +
                serie.nombre +
                "</a></li>";
            });
            html += "</ul>";
            $("#desplegable").html(html);
          },
        });
      }
    </script>
  </body>
</html>
